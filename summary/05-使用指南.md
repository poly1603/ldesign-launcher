# Vite Launcher - 使用指南

## 快速开始

### 安装

```bash
# 使用 npm
npm install @ldesign/launcher

# 使用 yarn
yarn add @ldesign/launcher

# 使用 pnpm
pnpm add @ldesign/launcher
```

### 基础使用

```typescript
import { ViteLauncher } from '@ldesign/launcher'

// 创建启动器实例
const launcher = new ViteLauncher({
  logLevel: 'info',
  mode: 'development'
})

// 创建新项目
await launcher.create('./my-vue-app', 'vue3')

// 启动开发服务器
const server = await launcher.dev('./my-vue-app')

// 构建项目
const result = await launcher.build('./my-vue-app')
```

## 详细使用说明

### 1. 创建项目

#### 支持的项目类型
- `vue2` - Vue 2.x 项目
- `vue3` - Vue 3.x 项目
- `react` - React 项目
- `vanilla` - 原生 JavaScript 项目
- `vanilla-ts` - TypeScript 项目
- `lit` - Lit 组件项目
- `svelte` - Svelte 项目

#### 创建选项
```typescript
interface CreateOptions {
  force?: boolean          // 强制覆盖现有目录
  template?: string        // 指定模板名称
  packageManager?: 'npm' | 'yarn' | 'pnpm'  // 包管理器
  features?: string[]      // 额外功能特性
}

// 示例
await launcher.create('./my-app', 'vue3', {
  force: true,
  template: 'vue3-typescript',
  packageManager: 'pnpm',
  features: ['router', 'pinia', 'eslint']
})
```

### 2. 开发服务器

#### 启动开发服务器
```typescript
interface DevOptions {
  port?: number           // 端口号，默认 5173
  host?: string          // 主机地址，默认 localhost
  open?: boolean         // 自动打开浏览器
  https?: boolean        // 启用 HTTPS
  proxy?: Record<string, string>  // 代理配置
}

const server = await launcher.dev('./my-app', {
  port: 3000,
  host: '0.0.0.0',
  open: true,
  proxy: {
    '/api': 'http://localhost:8080'
  }
})

console.log(`Server running at http://localhost:${server.config.server.port}`)
```

#### 停止开发服务器
```typescript
await launcher.stop()
```

### 3. 构建项目

#### 构建选项
```typescript
interface BuildOptions {
  mode?: 'development' | 'production'  // 构建模式
  outDir?: string                      // 输出目录
  minify?: boolean                     // 是否压缩
  sourcemap?: boolean                  // 生成 sourcemap
  target?: string                      // 构建目标
  rollupOptions?: RollupOptions        // Rollup 选项
}

const result = await launcher.build('./my-app', {
  mode: 'production',
  outDir: 'dist',
  minify: true,
  sourcemap: true
})

console.log(`Build completed in ${result.duration}ms`)
console.log(`Output files: ${result.outputFiles.length}`)
```

#### 构建结果
```typescript
interface BuildResult {
  success: boolean        // 构建是否成功
  duration: number        // 构建耗时（毫秒）
  outputFiles: string[]   // 输出文件列表
  size: number           // 总文件大小
  errors?: string[]      // 错误信息
  warnings?: string[]    // 警告信息
  stats?: BuildStats     // 构建统计
}
```

### 4. 预览服务器

```typescript
interface PreviewOptions {
  port?: number          // 端口号，默认 4173
  host?: string         // 主机地址
  outDir?: string       // 构建输出目录
}

const previewServer = await launcher.preview('./my-app', {
  port: 8080,
  host: '0.0.0.0'
})
```

### 5. 项目信息获取

#### 获取项目信息
```typescript
const projectInfo = await launcher.getProjectInfo('./my-app')

console.log('Framework:', projectInfo.framework)
console.log('TypeScript:', projectInfo.typescript)
console.log('Dependencies:', projectInfo.dependencies)
console.log('Confidence:', projectInfo.confidence)
```

#### 获取项目类型
```typescript
const projectType = await launcher.getProjectType('./my-app')
console.log('Project type:', projectType)
```

### 6. 配置管理

#### 更新配置
```typescript
launcher.configure({
  logLevel: 'debug',
  mode: 'production'
})
```

#### 获取当前配置
```typescript
const config = launcher.getConfig()
console.log('Current config:', config)
```

## 便捷函数

### 快速创建项目
```typescript
import { createProject } from '@ldesign/launcher'

await createProject('./my-app', 'vue3', {
  features: ['router', 'pinia']
})
```

### 快速启动开发服务器
```typescript
import { startDev } from '@ldesign/launcher'

const server = await startDev('./my-app', {
  port: 3000,
  open: true
})
```

### 快速构建项目
```typescript
import { buildProject } from '@ldesign/launcher'

const result = await buildProject('./my-app', {
  mode: 'production'
})
```

### 快速启动预览服务器
```typescript
import { startPreview } from '@ldesign/launcher'

const server = await startPreview('./my-app')
```

## 高级用法

### 自定义配置

#### 项目级配置文件
在项目根目录创建 `vite-launcher.config.js`：

```javascript
export default {
  // 自定义 Vite 配置
  vite: {
    server: {
      port: 3000
    },
    build: {
      outDir: 'build'
    }
  },
  
  // 启动器配置
  launcher: {
    logLevel: 'debug',
    autoInstall: true
  }
}
```

#### 环境变量配置
```bash
# .env
VITE_LAUNCHER_PORT=3000
VITE_LAUNCHER_HOST=0.0.0.0
VITE_LAUNCHER_OPEN=true
```

### 插件扩展

```typescript
import { ViteLauncher } from '@ldesign/launcher'

const launcher = new ViteLauncher()

// 添加自定义插件
launcher.addPlugin({
  name: 'my-custom-plugin',
  apply: (launcher) => {
    launcher.hooks.beforeCreate.tap('my-plugin', (options) => {
      console.log('Before create:', options)
    })
  }
})
```

### 错误处理

```typescript
try {
  await launcher.create('./my-app', 'vue3')
} catch (error) {
  if (error.code === 'E001') {
    console.error('Directory already exists')
    console.log('Suggestion:', error.suggestion)
  } else {
    console.error('Unexpected error:', error.message)
  }
}
```

## 最佳实践

### 1. 项目结构建议
```
my-project/
├── src/                 # 源代码目录
│   ├── components/      # 组件目录
│   ├── views/          # 页面目录
│   ├── assets/         # 静态资源
│   └── main.ts         # 入口文件
├── public/             # 公共资源
├── tests/              # 测试文件
├── vite.config.ts      # Vite 配置
└── package.json        # 项目配置
```

### 2. 开发工作流
```bash
# 1. 创建项目
npx @ldesign/launcher create my-app vue3

# 2. 进入项目目录
cd my-app

# 3. 启动开发服务器
npm run dev

# 4. 构建生产版本
npm run build

# 5. 预览构建结果
npm run preview
```

### 3. 性能优化建议
- 使用 TypeScript 获得更好的开发体验
- 合理配置代码分割和懒加载
- 启用 gzip 压缩和缓存策略
- 使用 CDN 加速静态资源加载

### 4. 调试技巧
```typescript
// 启用详细日志
const launcher = new ViteLauncher({
  logLevel: 'debug'
})

// 查看项目检测详情
const projectInfo = await launcher.getProjectInfo()
console.log('Detection report:', projectInfo.report)
```

## 常见问题

### Q: 如何自定义项目模板？
A: 可以在项目中创建 `templates` 目录，并在配置中指定模板路径。

### Q: 如何处理端口冲突？
A: 启动器会自动检测端口占用并尝试使用下一个可用端口。

### Q: 如何集成到 CI/CD 流程？
A: 使用构建命令进行自动化构建，支持环境变量配置。

### Q: 如何添加自定义插件？
A: 通过 `addPlugin` 方法或在配置文件中指定插件列表。
